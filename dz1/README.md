##### Event Storming

#### **1. Менеджмент платформы**
Контекст включает команды и события, связанные с настройкой ключевых элементов системы, которые определяют её работу:

- **Команды**: 
  - «Задать новый тип услуги»
  - «Проверить качество выполненного заказа»
  - «Начислить денег воркеру»
  - «Сконфигурировать набор тестов»
- **События**:
  - «Задан тип услуги»
  - «Проверил качество выполненного заказа»
  - «Зачислил денег воркеру»
  - «Сконфигурирован набор тестов»

Логика: Все команды и события здесь связаны с действиями менеджеров, которые влияют на общие настройки системы и её базовые функции. Эти задачи не требуют участия других участников системы, таких как клиенты или воркеры, и могут выполняться независимо.

---

#### **2. Регистрация воркеров**
Контекст объединяет процесс добавления новых воркеров в систему, начиная от подачи заявки до завершения тестов:

- **Команды**: 
  - «Заполнить заявку»
  - «Назначить набор тестов»
  - «Пройти тест»
- **События**:
  - «Назначен набор тестов»
  - «Пройден тест»
  - «Тест провален/успешен»
  - «Добавлен в пул воркеров»

Логика: Этот процесс сосредоточен на управлении на добавления новых воркеров в систему.

---

#### **3. Оформление заказа**
Контекст описывает процесс от запроса услуги до метчинга воркера на услугу:

- **Команды**: 
  - «Запросить помощь»
  - «Назначить воркера на заказ»
- **События**:
  - «Запросил помощь»
  - «Воркер назначен»

Логика: Здесь сосредоточены взаимодействия между клиентами и системой при оформлении заказа.

---

#### **4. Сбор заказов для выполнения**
Контекст отвечает за процесс подготовки расходников и ресурсов для выполнения заказа:

- **Команды**:
  - «Заказать печенье»
  - «Собрать заказ»
  - «Выдать заказ воркеру»
- **События**:
  - «Собран заказ»
  - «Выдан заказ»

Логика: Этот контекст выделен для складских операций, необходимых перед началом выполнения заказа. Включает интеграцию с подрядчиками (печенье) и складским персоналом.

---

#### **5. Выполнение заказа**
Контекст описывает процесс работы воркера на заказе:

- **Команды**:
  - «Приступить к заказу»
  - «Отправить фото сделанного заказа»
- **События**:
  - «Отметился в приложении»
  - «Прислал фото отчета»

Логика: Этот контекст отделяет действия воркера на месте выполнения заказа от административных операций. Сосредоточен на отчётности и выполнении обязательств.

---

#### **6. Инвойсы**
Контекст объединяет процессы оплаты клиентов, расчёта зарплат воркерам и управления скидками:

- **Команды**: 
  - «Выставить инвойс клиенту»
  - «Списать деньги»
  - «Зачислить средства»
- **События**:
  - «Выставил инвойс клиенту»
  - «Списал деньги»
  - «Выставил инвойс воркеру»

Логика: Финансовые операции логически отделены от выполнения заказа, так как их обработка происходит асинхронно и требует взаимодействия с различными внешними системами (золотая шляпа).

---

#### **7. Тотализатор**
Контекст описывает работу системы ставок менеджеров:

- **Команды**: 
  - «Сделать ставку»
  - «Расчитать победителей ставок»
- **События**:
  - «Сделал ставку»

Логика: Ставки выделены в отдельный контекст, так как это специфический процесс, не влияющий напрямую на выполнение заказов или управление воркерами.



### Реализация проекта: Микросервисы

Для данной системы выбрана **микросервисная архитектура**. Это решение обусловлено сложностью и разнообразием функциональности системы, а также необходимостью масштабируемости, надёжности и независимого управления различными бизнес-процессами.

---

#### Почему была выбрана микросервисная архитектура

1. **Чёткая разделённость логики**:
   - Система состоит из нескольких независимых областей (регистрация, управление услугами, выполнение заказов, инвойсы и т. д.), каждая из которых имеет уникальную бизнес-логику.
   - Выделение отдельных микросервисов позволяет разделить ответственность между командами разработки, упростить тестирование и улучшить поддержку системы.

2. **Масштабируемость**:
   - Разные части системы имеют разные требования к нагрузке. Например:
     - Модуль ренистрации должен справляться с большим количеством заявок (1к в день и бороться с дудосом от конкурентов).
     - Модуль инвойсов требует точности и стабильности, но относительно низкой производительности.
   - Микросервисы позволяют масштабировать только те модули, которые действительно нуждаются в дополнительных ресурсах.

3. **Надёжность и отказоустойчивость**:
   - В случае сбоя одного сервиса (например, инвойсы), другие сервисы (например, регистрация или выполнение заказов) могут продолжать работать, что повышает устойчивость всей системы.

4. **Гибкость в технологиях**:
   - Разные сервисы могут использовать разные технологии, оптимально подходящие под их задачи.

5. **Упрощение обновлений и интеграций**:
   - Микросервисы можно обновлять или заменять независимо друг от друга, что упрощает внедрение новых функций и исправление ошибок.

---

#### Рассматриваемые альтернативы

1. **Монолит**:
   - Простой в реализации, особенно для старта проекта.
   - Отклонён из-за сложности управления масштабируемостью и высокой взаимосвязанности всех компонентов, что может привести к сбоям при изменениях или высокой нагрузке.

2. **Сервис-ориентированная архитектура (SOA)**:
   - Было бы подходящим решением для небольших проектов.
   - Отклонено из-за необходимости высокой масштабируемости, которая лучше поддерживается микросервисами.

---

#### Модель коммуникации: Синхронные и асинхронные коммуникации

Для микросервисов выбрана **гибридная модель коммуникации**, включающая как синхронные, так и асинхронные взаимодействия.

1. **Синхронные коммуникации**:
   Используются для процессов, требующих мгновенного ответа:
   - Изменение статуса заказа клиентом.
   - Расчёт стоимости услуги.

   **Обоснование**:
   - Быстродействие необходимо для операций, где пользователи ожидают немедленного ответа.
   - Простота в реализации запросов, зависящих от внешнего ответа.

2. **Асинхронные коммуникации**:
   Используются для процессов, которые не требуют мгновенного отклика:
   - Отправка нотификаций.
   - Передача данных о проваленных заказах в отдел контроля качества.
   - Обработка ставок в тотализаторе.
   - Заказ печенья у подрядчика.
   - Подбор воркера для заказа.

   **Обоснование**:
   - Асинхронные процессы позволяют разгрузить систему и обрабатывать задачи в фоновом режиме.
   - Это повышает устойчивость системы и снижает задержки для критически важных операций.
